<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SSH :: Léon&#x27;s Note</title>
    <meta name="generator" content="Antora 3.1.7">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/css/vendor/search.css">
    <link rel="stylesheet" href="../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="v0.4.16"> 
    <meta name="version" content="">
    <meta name="component" content="bash">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://spring.io">
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <label class="theme-toggler">
      <input
        type="checkbox"
        type="checkbox"
        id="switch-theme-checkbox"
        name="switch-theme-checkbox"
      />
      <span class="icon"><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="moon"
          class="svg-inline--fa fa-moon moon"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 384 512"
        ><path
            fill="currentColor"
            d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"
          ></path>
        </svg>
        <svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="sun"
          class="svg-inline--fa fa-sun sun"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        ><path
            fill="currentColor"
            d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"
          ></path>
        </svg></span>
      <span class="text">light</span>
    </label>
  </nav>
</header>
<script>
!function (theme) {
  if (theme === 'dark') {
    document.getElementById('switch-theme-checkbox').parentElement.classList.add('active')
  }
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'))
</script>
<div class="body">
<div class="nav-container" data-component="bash" data-version="">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">Léon&#x27;s Bash Note</span>
  <span class="version">default</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div>          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title="SSH"
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  </nav>
</div><h1 id="page-title" class="page">SSH</h1>
<div class="sect1">
<h2 id="_basic"><a class="anchor" href="#_basic"></a>1. Basic</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ssh_keys"><a class="anchor" href="#_ssh_keys"></a>1.1. SSH keys</h3>
<div id="SSH_keys" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script"># ~/.ssh/
ssh-keygen -t ed25519 -N '' -C "$(whoami)@$(uname -n)-$(date -I)" -f ~/.ssh/id_ed25519_zhanglei

ssh-copy-id -i ~/.ssh/id_ed25519_zhanglei.pub root@172.16.254.192
pbcopy &lt; ~/.ssh/id_ed25519_zhanglei.pub

# ~/.ssh/config
Host 172.16.254.192
   HostName 172.16.254.192
   User root
   IdentityFile ~/.ssh/id_ed25519_zhanglei</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_multiple_commands_on_remote_server"><a class="anchor" href="#_run_multiple_commands_on_remote_server"></a>1.2. run multiple commands on remote server</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script"># ssh bar@foo command
ssh bar@foo "command1 &amp;&amp; command2"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bash_here_document_syntax_to_run_multiple_ssh_command"><a class="anchor" href="#_bash_here_document_syntax_to_run_multiple_ssh_command"></a>1.3. Bash <a href="Heredoc.adoc">here document syntax</a> to run multiple SSH command</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">ssh server1 &lt;&lt; HERE
 command1
 command2
HERE</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_local_bash_script_on_remote_system"><a class="anchor" href="#_running_local_bash_script_on_remote_system"></a>1.4. Running local bash script on remote system</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">ssh bar@foo 'bash -s' &lt; /home/vivek/bin/test.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_port_forwarding"><a class="anchor" href="#_port_forwarding"></a>2. Port Forwarding</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.ssh.com/ssh/tunneling/example">example</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>-N</strong>      Do not execute a remote command.  This is useful for just forwarding ports.</p>
</li>
<li>
<p><strong>-f</strong>      Requests ssh to go to background just before command execution.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ssh-tunnels.png" alt="SSH Tunneling">
</div>
</div>
<div class="sect2">
<h3 id="_local_forwarding"><a class="anchor" href="#_local_forwarding"></a>2.1. Local Forwarding</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">ssh -L [bind_address:]port:host:hostport ssh_server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh -CfN -L 8080:localhost:80 ssh_server</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>C</strong>      Requests compression of all data (including stdin, stdout, stderr, and data for port forwarding) before sending it.</p>
</li>
<li>
<p><strong>L</strong>      Specifies that the given port on the local (client) host is to be forwarded to the given host and port on the remote side.</p>
</li>
</ol>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="_images/diag-f668ba7dd42c41fba10f1ae23985743f7df76f6f.svg" alt="Diagram">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_remote_forwarding"><a class="anchor" href="#_remote_forwarding"></a>2.2. Remote Forwarding</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">ssh -R [bind_address:]port:host:hostport ssh_server
# -g : bind to all interfaces</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh -fN -R 8080:localhost:80 ssh_server</pre>
</div>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="_images/diag-ca43f4a3305a066ee9f9ad6e1b5c0120ef40c885.svg" alt="Diagram">
</div>
</div>
<div class="sect3">
<h4 id="_server_side_configuration"><a class="anchor" href="#_server_side_configuration"></a>2.2.1. Server-Side Configuration</h4>
<div class="paragraph">
<div class="title">/etc/ssh/sshd_config</div>
<p>GatewayPorts yes</p>
</div>
<div class="paragraph">
<div class="title">restart ssh service</div>
<p>systemctl restart sshd</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_port_forwarding"><a class="anchor" href="#_dynamic_port_forwarding"></a>2.3. Dynamic Port Forwarding</h3>
<div class="listingblock">
<div class="content">
<pre>ssh -D port ssh_server</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>nohup ssh -qTfnN -D 127.0.0.1:38080 ssh_server "vmstat 10" 2&gt;&amp;1 &gt;/dev/null &amp;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>-q</strong>      Quiet mode.  Causes most warning and diagnostic messages to be suppressed.</p>
</li>
<li>
<p><strong>-T</strong>      Disable pseudo-tty allocation.</p>
</li>
<li>
<p><strong>-n</strong>      Redirects stdin from /dev/null (actually, prevents reading from stdin).</p>
</li>
<li>
<p><strong>-D</strong>      Specifies a local <code>dynamic</code> application-level port forwarding.  This works by allocating a socket to listen to port on the local side, optionally bound to the specified bind_address.  Whenever a connection is made to this port, the connection is forwarded over the secure channel, and the application protocol is then used to determine where to connect to from the remote machine. Currently the SOCKS4 and SOCKS5 protocols are supported, and ssh will act as a SOCKS server.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jump_host"><a class="anchor" href="#_jump_host"></a>3. Jump Host</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.cyberciti.biz/faq/linux-unix-ssh-proxycommand-passing-through-one-host-gateway-server/">SSH ProxyCommand article</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh -J Jumphost FooServer</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sshd"><a class="anchor" href="#_sshd"></a>4. sshd</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre># 是否允许密码登录
PasswordAuthentication no
# 指定 sshd 监听的端口
Port 2022
# 指定用户 SSH 登录一个域名时，服务器是否使用 DNS
UseDNS no
GSSAPIAuthentication no</pre>
</div>
</div>
<div class="paragraph">
<p>grep "<sup>[</sup>#;]" /etc/ssh/sshd_config</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sed -i 's/#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config
sed -i 's/GSSAPIAuthentication yes/GSSAPIAuthentication no/g' /etc/ssh/sshd_config

systemctl restart sshd</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ssh_keygen"><a class="anchor" href="#_ssh_keygen"></a>5. ssh-keygen</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Removes all keys belonging to the specified hostname</div>
<div class="content">
<pre>ssh-keygen -R hostname</pre>
</div>
</div>
<div class="listingblock">
<div class="title">examples</div>
<div class="content">
<pre>ssh-keygen -R 127.0.0.1
ssh-keygen -R [127.0.0.1]:2022</pre>
</div>
</div>
<div class="listingblock">
<div class="title">prints the public key</div>
<div class="content">
<pre>ssh-keygen -y -f ~/.ssh/id_rsa</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session"><a class="anchor" href="#_session"></a>6. session</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ends the current session</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Ctrl+D</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revoke_ssh_key"><a class="anchor" href="#_revoke_ssh_key"></a>7. revoke ssh key</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://docs.rundeck.com/docs/learning/howto/revoke-ssh-keys.html#using-revocation-currently" class="bare">https://docs.rundeck.com/docs/learning/howto/revoke-ssh-keys.html#using-revocation-currently</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs"><a class="anchor" href="#_docs"></a>8. docs</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://wangdoc.com/ssh" class="bare">http://wangdoc.com/ssh</a>
<a href="https://wiki.archlinux.org/title/SSH_keys" class="bare">https://wiki.archlinux.org/title/SSH_keys</a></p>
</div>
</div>
</div>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
              <div class="colset">
                <div class="col-left">
                  <ul class="nav-versions">
                    <li class="component">
                      <a class="title" href="../ai/index.html">Léon's AI Note</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../ai/index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component is-current">
                      <a class="title" href="index.html">Léon's Bash Note</a>
                      <ul class="versions">
                        <li class="version is-current is-latest">
                          <a href="index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component">
                      <a class="title" href="../blog/index.html">Léon's Blog</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../blog/index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component">
                      <a class="title" href="../database/index.html">Léon's Database Note</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../database/index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component">
                      <a class="title" href="../java/index.html">Léon's Java Note</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../java/index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component">
                      <a class="title" href="../kubernetes/index.html">Léon's Kubernetes Note</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../kubernetes/index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component">
                      <a class="title" href="../language/index.html">Léon's Language Note</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../language/index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component">
                      <a class="title" href="../linux/index.html">Léon's Linux Note</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../linux/index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component">
                      <a class="title" href="../python/index.html">Léon's Python Note</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../python/index.html">
                            default<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </main>
        </div>
    </div>
</div>

</div>
<script src="../_/js/vendor/import.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script async src="../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
